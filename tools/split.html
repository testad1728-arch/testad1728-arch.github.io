<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>تقسيم ملف PDF | PDF Studio</title>

<style>
  body{margin:0;background:#f7f8fb;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:#0f172a;}
  .container{max-width:750px;margin:60px auto;padding:20px;background:#fff;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.07);}
  h1{text-align:center;margin-bottom:6px;font-size:28px;}
  p{text-align:center;color:#6b7280;margin-bottom:30px;}
  input[type="file"]{display:block;margin:0 auto 18px;padding:14px;border-radius:12px;border:2px dashed #9ca3af;background:#fff;cursor:pointer;width:100%;}
  .row{display:flex;gap:12px;margin-top:14px;justify-content:center;}
  button{
    background:#e53935;color:#fff;border:none;padding:14px 22px;font-size:16px;
    border-radius:12px;cursor:pointer;transition:.25s;
  }
  button:hover{background:#c62828;}
  #pagesCount{text-align:center;margin:12px 0;color:#374151;font-weight:bold;}
  .back{display:block;text-align:center;margin-top:22px;color:#2563eb;text-decoration:none;}
</style>

<script src="https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.min.js"></script>

</head>
<body>

<div class="container">
  <h1>تقسيم ملف PDF</h1>
  <p>اختر ملف PDF ثم قم بتقسيمه إلى صفحات منفصلة أو مجموعات صفحات.</p>

  <input type="file" id="pdfFile" accept="application/pdf">

  <div id="pagesCount"></div>

  <div class="row">
    <button onclick="splitPages()">تقسيم إلى صفحات منفصلة</button>
    <button onclick="extractRange()">استخراج نطاق محدد</button>
  </div>

  <a href="../index.html" class="back">العودة للصفحة الرئيسية</a>
</div>

<script>
let pdfDoc, totalPages;

document.getElementById("pdfFile").addEventListener("change", async (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  const bytes = await file.arrayBuffer();
  pdfDoc = await PDFLib.PDFDocument.load(bytes);
  totalPages = pdfDoc.getPageCount();
  document.getElementById("pagesCount").innerHTML = "عدد الصفحات: " + totalPages;
});

async function splitPages(){
  if(!pdfDoc) return alert("الرجاء اختيار ملف أولاً");
  for(let i=0;i<totalPages;i++){
    const newPdf = await PDFLib.PDFDocument.create();
    const [page] = await newPdf.copyPages(pdfDoc,[i]);
    newPdf.addPage(page);
    const pdfBytes = await newPdf.save();
    download(pdfBytes,`page-${i+1}.pdf`);
  }
}

async function extractRange(){
  if(!pdfDoc) return alert("الرجاء اختيار ملف أولاً");
  let range = prompt("أدخل نطاق الصفحات مثل: 1-3");
  if(!range) return;
  let parts = range.split("-");
  let start = parseInt(parts[0])-1;
  let end = parseInt(parts[1])-1;
  if(start<0 || end>=totalPages) return alert("نطاق غير صحيح");

  const newPdf = await PDFLib.PDFDocument.create();
  const pages = await newPdf.copyPages(pdfDoc, [...Array(end-start+1).keys()].map(i=>i+start));
  pages.forEach(p=>newPdf.addPage(p));
  const pdfBytes = await newPdf.save();
  download(pdfBytes,`pages-${start+1}-${end+1}.pdf`);
}

function download(bytes,filename){
  const blob=new Blob([bytes],{type:"application/pdf"});
  const url=URL.createObjectURL(blob);
  const a=document.createElement("a");
  a.href=url;a.download=filename;a.click();
  URL.revokeObjectURL(url);
}
</script>

</body>
</html>
