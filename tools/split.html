<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>تقسيم ملف PDF | Free PDF Tools</title>
<meta name="description" content="قسّم ملف PDF إلى عدة ملفات أو استخرج نطاق صفحات داخل المتصفح." />
<link rel="stylesheet" href="../assets/style.css" />
</head>
<body>
  <main class="container">
    <a href="../index.html" target="_blank" rel="noopener">↗ الصفحة الرئيسية (تبويب جديد)</a>
    <article class="card" style="margin-top:12px">
      <h1>تقسيم ملف PDF</h1>
      <p class="muted">اختر ملف PDF، ثم اختر وضع التقسيم.</p>

      <div class="card">
        <label class="btn" for="file-input">اختيار ملف</label>
        <input type="file" id="file-input" accept="application/pdf" hidden>
        <div id="info" class="muted" style="margin-top:8px">لم يتم اختيار ملف</div>

        <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:10px">
          <button id="split-each" class="btn" disabled>تقسيم إلى ملفات صفحات منفصلة</button>
          <button id="extract-range" class="btn" disabled>استخراج نطاق صفحات</button>
        </div>

        <div style="margin-top:10px" id="range-wrap" hidden>
          <label>من صفحة: <input id="from" type="number" min="1" style="width:80px" /></label>
          <label>إلى صفحة: <input id="to" type="number" min="1" style="width:80px" /></label>
          <button id="do-range" class="btn">تنزيل</button>
        </div>

        <div id="results" style="margin-top:12px"></div>
      </div>
    </article>
  </main>

<script type="module">
import { PDFDocument } from "https://cdn.jsdelivr.net/npm/pdf-lib/dist/pdf-lib.esm.js";
const input = document.getElementById('file-input');
const info = document.getElementById('info');
const splitEach = document.getElementById('split-each');
const extractRange = document.getElementById('extract-range');
const rangeWrap = document.getElementById('range-wrap');
const doRange = document.getElementById('do-range');
const results = document.getElementById('results');
const from = document.getElementById('from');
const to = document.getElementById('to');

let bytes, pdf, pageCount = 0;
input.addEventListener('change', async () => {
  const f = input.files[0];
  if(!f){ return; }
  bytes = await f.arrayBuffer();
  pdf = await PDFDocument.load(bytes);
  pageCount = pdf.getPageCount();
  info.textContent = `الملف: ${f.name} — عدد الصفحات: ${pageCount}`;
  splitEach.disabled = false; extractRange.disabled = false;
});

splitEach.addEventListener('click', async () => {
  if(!pdf) return;
  results.innerHTML = '';
  for(let i=0;i<pageCount;i++){
    const out = await PDFDocument.create();
    const [page] = await out.copyPages(pdf, [i]);
    out.addPage(page);
    const b = await out.save();
    downloadBlob(b, `page-${i+1}.pdf`);
  }
});

extractRange.addEventListener('click', () => {
  rangeWrap.hidden = false;
  from.max = pageCount; to.max = pageCount;
  from.value = 1; to.value = pageCount;
});

doRange.addEventListener('click', async () => {
  const a = Math.max(1, parseInt(from.value||'1',10));
  const b = Math.min(pageCount, parseInt(to.value||String(pageCount),10));
  if(a>b) return;
  const out = await PDFDocument.create();
  const idx = [];
  for(let i=a-1;i<b;i++) idx.push(i);
  const pages = await out.copyPages(pdf, idx);
  pages.forEach(p => out.addPage(p));
  const bytes = await out.save();
  downloadBlob(bytes, `pages-${a}-{b}.pdf`.replace('{b}', b));
});

function downloadBlob(arr, name){
  const blob = new Blob([arr], { type: 'application/pdf' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = name;
  a.textContent = `تنزيل ${name}`;
  a.style.display = 'block';
  results.appendChild(a);
}
</script>
</body>
</html>